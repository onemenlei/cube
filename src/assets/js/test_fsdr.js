var FSDR = {
    datajson: { "data": [{ "schIds": [280015], "examDate": 1525708800000, "examGradeId": 8, "examTypeName": "模拟考试", "sortId": 3, "examId": 2001525760853464, "examName": "模拟考试_20180508", "examGradeName": "八年级", "examType": 3, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1516636800000, "examGradeId": 8, "examTypeName": "期末考试", "sortId": 3, "examId": 2001517106070916, "examName": "七中育才_8年级_期末考试_20180123", "examGradeName": "八年级", "examType": 5, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1516636800000, "examGradeId": 7, "examTypeName": "期末考试", "sortId": 3, "examId": 2001517106010282, "examName": "七中育才_7年级_期末考试_20180123", "examGradeName": "七年级", "examType": 5, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1516636800000, "examGradeId": 9, "examTypeName": "期末考试", "sortId": 3, "examId": 2001517105948315, "examName": "七中育才_9年级_期末考试_20180123", "examGradeName": "九年级", "examType": 5, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1498579200000, "examGradeId": 8, "examTypeName": "期末考试", "sortId": 3, "examId": 2001498901439465, "examName": "七中育才_期末考试_20170628", "examGradeName": "八年级", "examType": 5, "termId": 2 }, { "schIds": [280011, 280015, 280010], "examDate": 1498579200000, "examGradeId": 7, "examTypeName": "期末考试", "sortId": 3, "examId": 2001498901429786, "examName": "七中育才_期末考试_20170628", "examGradeName": "七年级", "examType": 5, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1496160000000, "examGradeId": 9, "examTypeName": "月考", "sortId": 3, "examId": 2001496195562171, "examName": "七中育才_月考_20170531", "examGradeName": "九年级", "examType": 2, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1493740800000, "examGradeId": 9, "examTypeName": "模拟考试", "sortId": 3, "examId": 2001494211738321, "examName": "七中育才_模拟考试_20170503", "examGradeName": "九年级", "examType": 3, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1492617600000, "examGradeId": 7, "examTypeName": "期中考试", "sortId": 3, "examId": 2001492751000293, "examName": "七中育才_期中考试_20170420", "examGradeName": "七年级", "examType": 4, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1492617600000, "examGradeId": 8, "examTypeName": "期中考试", "sortId": 3, "examId": 2001492750920954, "examName": "七中育才_期中考试_20170420", "examGradeName": "八年级", "examType": 4, "termId": 2 }, { "schIds": [280010, 280015, 280011], "examDate": 1491753600000, "examGradeId": 9, "examTypeName": "月考", "sortId": 3, "examId": 2001491879929432, "examName": "七中育才_月考_20170410", "examGradeName": "九年级", "examType": 2, "termId": 2 }, { "schIds": [280015], "examDate": 1489075200000, "examGradeId": 9, "examTypeName": "月考", "sortId": 3, "examId": 2001489027948329, "examName": "七中育才_月考_20170310", "examGradeName": "九年级", "examType": 2, "termId": 2 }, { "schIds": [280010, 280011, 280015], "examDate": 1486656000000, "examGradeId": 9, "examTypeName": "期初考试", "sortId": 3, "examId": 2001486625348230, "examName": "七中育才_期初考试_20170210", "examGradeName": "九年级", "examType": 6, "termId": 2 }, { "schIds": [280011, 280010, 280015], "examDate": 1483891200000, "examGradeId": 9, "examTypeName": "期末考试", "sortId": 3, "examId": 2001484276503475, "examName": "锦江区统考_期末考试_20170109", "examGradeName": "九年级", "examType": 5, "termId": 1 }, { "schIds": [280011, 280010, 280015], "examDate": 1483891200000, "examGradeId": 8, "examTypeName": "期末考试", "sortId": 3, "examId": 2001483949318936, "examName": "七中育才_期末考试_20170109", "examGradeName": "八年级", "examType": 5, "termId": 1 }, { "schIds": [280011, 280010, 280015], "examDate": 1483891200000, "examGradeId": 7, "examTypeName": "期末考试", "sortId": 3, "examId": 2001483949183864, "examName": "七中育才_期末考试_20170109", "examGradeName": "七年级", "examType": 5, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1478102400000, "examGradeId": 9, "examTypeName": "期中考试", "sortId": 3, "examId": 2001477975053372, "examName": "七中育才_期中考试_20161103", "examGradeName": "九年级", "examType": 4, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1477411200000, "examGradeId": 8, "examTypeName": "期中考试", "sortId": 3, "examId": 2001477453471319, "examName": "七中育才_期中考试_20161026", "examGradeName": "八年级", "examType": 4, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1477411200000, "examGradeId": 7, "examTypeName": "期中考试", "sortId": 3, "examId": 2001477453422613, "examName": "七中育才_期中考试_20161026", "examGradeName": "七年级", "examType": 4, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1475856000000, "examGradeId": 9, "examTypeName": "月考", "sortId": 3, "examId": 2001475218634067, "examName": "七中育才_月考_20161008", "examGradeName": "九年级", "examType": 2, "termId": 1 }, { "schIds": [280015, 280010, 280011], "examDate": 1453219200000, "examGradeId": 7, "examTypeName": "期末考试", "sortId": 3, "examId": 2001472115909607, "examName": "七中育才_期末考试_20160120", "examGradeName": "七年级", "examType": 5, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1447257600000, "examGradeId": 7, "examTypeName": "期中考试", "sortId": 3, "examId": 2001472115826923, "examName": "七中育才_期中考试_20151112", "examGradeName": "七年级", "examType": 4, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1467129600000, "examGradeId": 7, "examTypeName": "期末考试", "sortId": 3, "examId": 2001472114610385, "examName": "七中育才_期末考试_20160629", "examGradeName": "七年级", "examType": 5, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1447257600000, "examGradeId": 8, "examTypeName": "期中考试", "sortId": 3, "examId": 2001472112163464, "examName": "育才_14_08_期中_数学_20151112", "examGradeName": "八年级", "examType": 4, "termId": 1 }, { "schIds": [280015, 280011, 280010], "examDate": 1453219200000, "examGradeId": 8, "examTypeName": "期末考试", "sortId": 3, "examId": 2001472110515448, "examName": "七中育才_期末考试_20160120", "examGradeName": "八年级", "examType": 5, "termId": 1 }, { "schIds": [280015], "examDate": 1463673600000, "examGradeId": 8, "examTypeName": "月考", "sortId": 3, "examId": 2001472099557516, "examName": "银杏_月考_20160520", "examGradeName": "八年级", "examType": 2, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1461168000000, "examGradeId": 8, "examTypeName": "期中考试", "sortId": 3, "examId": 2001472097069592, "examName": "七中育才_期中考试_20160421", "examGradeName": "八年级", "examType": 4, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1467129600000, "examGradeId": 8, "examTypeName": "期末考试", "sortId": 3, "examId": 2001472092846048, "examName": "七中育才_期末考试_20160629", "examGradeName": "八年级", "examType": 5, "termId": 2 }, { "schIds": [280015, 280011, 280010], "examDate": 1461168000000, "examGradeId": 7, "examTypeName": "期中考试", "sortId": 3, "examId": 2001471922675507, "examName": "七中育才_期中考试_20160421", "examGradeName": "七年级", "examType": 4, "termId": 2 }], "success": true },
    dataSelect: { "data": [{ "school_belongto": ["七中育才银杏"], "id": "190", "schools": [{ "school_belongto": "七中育才银杏", "name": "七中育才银杏", "code": "280015" }], "subject": [{ "subject_name": "英语", "subject_id": "667" }, { "subject_name": "物理", "subject_id": "668" }, { "subject_name": "化学", "subject_id": "669" }, { "subject_name": "生物", "subject_id": "685" }], "name": "七中育才9月考银杏180316(七中育才银杏)" }, { "school_belongto": ["七中育才银杏"], "id": "283", "schools": [{ "school_belongto": "七中育才银杏", "name": "七中育才银杏", "code": "280015" }], "subject": [{ "subject_name": "英语", "subject_id": "1005" }, { "subject_name": "物理", "subject_id": "1006" }, { "subject_name": "化学", "subject_id": "1007" }], "name": "银杏9年级月考20180420(七中育才银杏)" }, { "school_belongto": ["七中育才银杏"], "id": "331", "schools": [{ "school_belongto": "七中育才银杏", "name": "七中育才银杏", "code": "280015" }], "subject": [{ "subject_name": "理科综合", "subject_id": "1243" }, { "subject_name": "语文", "subject_id": "1220" }, { "subject_name": "数学", "subject_id": "1221" }, { "subject_name": "英语", "subject_id": "1222" }], "name": "银杏7年级半期20180504(七中育才银杏)" }, { "school_belongto": ["七中育才银杏"], "id": "332", "schools": [{ "school_belongto": "七中育才银杏", "name": "七中育才银杏", "code": "280015" }], "subject": [{ "subject_name": "语文", "subject_id": "1223" }, { "subject_name": "数学", "subject_id": "1224" }, { "subject_name": "英语", "subject_id": "1225" }, { "subject_name": "物理", "subject_id": "1226" }, { "subject_name": "理科数学", "subject_id": "1242" }], "name": "银杏8年级半期20180504(七中育才银杏)" }], "success": true },
    init: function() {
        FSDR.renderTable(FSDR.datajson.data);
        // console.log(FSDR.dataSelect.data);
    },
    // 初始化考试接口数据
    requestTable: function() {
        Tomd.wait('加载中...');
        $.ajax({
            url: '/path/to/file',
            type: 'POST',
            dataType: 'json',
            data: { param1: 'value1' },
            success: function(data) {
                Tomd.waitok();
                // 重新加载
                FSDR.renderTable(res);
            },
            error: function(data) {
                if (data) {
                    Tomd.waitok();
                    Tomd.alert('', '数据加载失败，请稍候再试！', '确定');
                } else if (data) {
                    Tomd.waitok();
                    Tomd.alert('', '网络不给力，请稍候再试！', '确定');
                }
            }
        });
    },
    renderTable: function(res) {
        // console.log(res)
        $('#scoreContent').DataTable({
            'emptyTable': '没有数据',
            'loadingRecords': '加载中...',
            'ordering': false, //不排序    
            // 'lengthChange': false, //不显示分页下拉列表
            "bAutoWidth": false, //是否自适应宽度
            "info": false, //不显示信息
            // 'searching': false,  //关闭搜索
            'language': {
                'url': 'datatables_language.json'
            },
            'data': res,
            'columns': [
                { 'data': 'examName' },
                { 'data': 'examGradeName' },
                { 'data': 'sortId' },
                { 'data': null },
                { 'data': null }
            ],

            'columnDefs': [{
                'targets': 3,
                render: function(data) {
                    var html = `${new Date(data.examDate).Format("yyyy-MM-dd")}`
                    return html;
                }
            }, {
                'targets': -1,
                render: function(data) {
                    return `<button onclick="FSDR.onClickSchsScore(${data.examId})" type="button" class="btn btn-success btn-xs"><i class="iconfont icon-bianji"></i>导入总分</button><button onclick="FSDR.onClickSchsDetails(${data.examId})" type="button" class="btn btn-primary btn-xs"><i class="iconfont icon-bianji"></i>导入详分</button>`
                }
            }]
        });
    },
    onClickSchsScore: function(id) {
        let html = $('#scoreTemplate').html();
        Tomd.alert('导入总分', html, '取消');
        $('.T-modal').off('click');
        $('.T-dialog').addClass('T-dialog-lg T-dialog-initial');
        $('.T-foot').prepend(`<a onclick="FSDR.onClickSchsScoreOk(${id})">保存</a>`);
        FSDR.initSelectType();
    },
    onClickSchsDetails: function(id) {
        let html = $('#scoreTemplate').html();
        Tomd.alert('导入详分', html, '取消');
        $('.T-modal').off('click');
        $('.T-dialog').addClass('T-dialog-lg T-dialog-initial');
        $('.T-foot').prepend(`<a onclick="FSDR.onClickSchsDetailsOk(${id})">保存</a>`);
        FSDR.initSelectType();
    },
    initSelectType: function() {
        let res = FSDR.dataSelect.data;
        // 弹框初始化
        let schoolName = '';
        for (let i = 0; i < res.length; i++) {
            schoolName += `<option value="${res[i].id}">${res[i].name}</option>`;
        };
        $('#select').html(schoolName);
        let select = $('#select').val();
        FSDR.renderSelectType(select, res);

        // 选择时改变数据
        $('body').on('change', '#select', function() {
            let select = $(this).val();
            FSDR.renderSelectType(select, res);
        });
    },
    // 渲染弹框数据
    renderSelectType: function(id, res) {
            for (let i = 0; i < res.length; i++) {
                let s = '';
                if (res[i].id == id) {
                    $('#hyExamId').val(res[i].id);
                    $('#hyExamName').val(res[i].name);
                    let subject = res[i].subject;
                    for (let i = 0; i < subject.length; i++) {
                        s += `<div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="s${i}" value="${subject[i].subject_id}">
                            <label class="form-check-label" for="s${i}">${subject[i].subject_name}</label>
                        </div>`
                    };
                    $('#subject').html(s);
                }
            }
        }
        // 保存导入总分
        ,
    onClickSchsScoreOk: function(id) {
            // console.log(id);
            Tomd.wait('加载中...');
            $.ajax({
                url: '/path/to/file',
                type: 'POST',
                dataType: 'json',
                data: { param1: 'value1' },
                success: function(data) {
                    Tomd.waitok();
                    // 重新加载
                    FSDR.renderTable(res);
                },
                error: function(data) {
                    if (data) {
                        Tomd.waitok();
                        Tomd.alert('', '导入总分失败，请稍候再试！', '确定');
                    } else if (data) {
                        Tomd.waitok();
                        Tomd.alert('', '网络不给力，请稍候再试！', '确定');
                    }
                }
            });
        }
        // 保存导入详分
        ,
    onClickSchsDetailsOk: function(id) {
        var arrSubj = [];
        $('#subject input[type=checkbox]:checked').each(function(){
            arrSubj.push($(this).val())
        })
        if (arrSubj.length == 0) {
            Tomd.alert('','请选择需要导入的学科','确定')
        }else {
            $('#test_article').load('test_drxf.html', function(){
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.src = '../assets/js/' + 'test_drxf.js';
                document.body.appendChild(script);
            });
            Tomd.delmodal();
        }
    }
}
FSDR.init();